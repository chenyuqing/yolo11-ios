# 🎙️ 语音识别问题调试指南

## 🔍 常见问题排查

### 1. 权限问题
**症状**: 点击语音按钮无反应，控制台显示"❌ 语音识别未授权"

**解决方案**:
- 确保已在设置中授权麦克风和语音识别权限
- 删除应用重新安装，重新授权
- 检查系统语言设置是否为中文

### 2. 网络连接问题
**症状**: 语音识别启动但无法识别内容

**解决方案**:
- iOS的语音识别需要网络连接
- 确保设备连接到互联网
- 尝试切换网络（WiFi <-> 蜂窝数据）

### 3. 语言设置问题
**症状**: 识别结果不准确或无法识别中文

**解决方案**:
- 在设备"设置" > "通用" > "语言与地区"中添加中文
- 确保键盘中包含中文输入法
- 在"设置" > "Siri与搜索"中设置语言为中文

### 4. 音频会话冲突
**症状**: 语音识别与相机音频冲突

**解决方案**:
- 应用已配置为`.playAndRecord`模式，支持同时录音和播放
- 如仍有问题，尝试重启应用

## 🛠️ 调试工具

### 使用内置诊断功能
1. 在语音交互界面点击"展开"按钮
2. 点击"诊断状态"按钮
3. 查看控制台输出的详细状态信息：
   - 授权状态
   - 录音状态  
   - 语音识别器可用性
   - 音频引擎状态
   - 设备语言设置
   - 权限状态

### 测试语音合成
1. 点击"测试语音"按钮
2. 应该听到"语音测试，如果您能听到这段话，说明语音合成功能正常"
3. 如无声音，检查设备音量和静音开关

## 📋 权限配置检查

确保项目中包含以下权限配置：

```xml
<!-- 麦克风权限 -->
<key>NSMicrophoneUsageDescription</key>
<string>This app needs access to the microphone.</string>

<!-- 语音识别权限 -->
<key>NSSpeechRecognitionUsageDescription</key>
<string>This app needs access to the speech recognition</string>
```

## 🔧 代码级调试

### 检查语音识别器初始化
```swift
// 应该看到这些日志
✅ 语音识别器初始化成功，语言: zh-CN
✅ 语音识别权限已授权  
✅ 麦克风权限已授权
✅ 音频会话配置成功
```

### 检查识别过程
```swift
// 开始识别时应该看到
🔄 尝试开始语音识别...
🎙️ 语音识别已启动

// 识别过程中应该看到
🎯 识别到文本: 你好
✅ 语音识别完成: 你好
```

## ⚠️ 重要提醒

1. **必须在真机测试**: 模拟器不支持麦克风功能
2. **需要网络连接**: iOS语音识别依赖Apple服务器
3. **语言环境**: 确保设备和应用语言设置为中文
4. **权限授权**: 首次使用需要用户手动授权

## 🎯 测试步骤

1. **权限测试**:
   - 启动应用，检查是否弹出权限请求
   - 点击"诊断状态"查看权限状态

2. **语音合成测试**:
   - 点击"测试语音"，确认能听到声音

3. **语音识别测试**:
   - 点击蓝色语音按钮
   - 说"你好"或"这是什么"
   - 查看是否有识别结果和AI回答

4. **对话测试**:
   - 说"这是什么？"测试物体识别
   - 说"有多少个人？"测试数量统计
   - 说"帮助"测试帮助系统

如果按照以上步骤仍无法解决问题，请检查：
- 设备型号兼容性
- iOS系统版本（需要iOS 18+）
- 网络连接稳定性
- 系统存储空间是否充足